{% extends "base.html" %}
{% block title %}Audit Logs{% endblock %}

{% block content %}
<h1>Audit Logs</h1>

<style>
  .audit-filters {
    margin-bottom: 15px;
  }
  .audit-filters label {
    margin-right: 12px;
  }
  .audit-pagination {
    text-align: center;
    margin-top: 12px;
  }
  .pagination-btn {
    display: inline-block;
    padding: 4px 10px;
    margin: 0 2px;
    border: 1px solid #ccc;
    border-radius: 4px;
    text-decoration: none;
    font-size: 0.9rem;
    color: #333;
    background-color: #f8f8f8;
  }
  .pagination-btn:hover {
    background-color: #e8e8e8;
  }
  .pagination-btn.current {
    font-weight: bold;
    background-color: #333;
    color: #fff;
    border-color: #333;
    cursor: default;
  }
  .pagination-btn.disabled {
    color: #aaa;
    border-color: #eee;
    background-color: #f5f5f5;
    pointer-events: none;
    cursor: default;
  }
  .pagination-info {
    margin-top: 6px;
    font-size: 0.85rem;
    color: #555;
  }
</style>

<!-- Simple Filters -->
<form method="get" class="audit-filters">
  <label>
    Username:
    <input type="text" name="username" value="{{ username }}">
  </label>

  <label>
    Action:
    <input type="text" name="action" value="{{ action }}">
  </label>

  <button type="submit">Filter</button>
  <a href="{{ url_for('admin_logs') }}">Reset</a>
</form>

<table border="1" cellpadding="4" cellspacing="0" style="width: 100%; border-collapse: collapse;">
  <thead>
    <tr>
      <th>Username</th>
      <th>Action</th>
      <th>Timestamp</th>
    </tr>
  </thead>
  <tbody>
    {% for log in logs %}
      <tr>
        <td>{{ log.username or 'System' }}</td>
        <td>{{ log.action }}</td>
        <td>{{ log.timestamp }}</td>
      </tr>
    {% else %}
      <tr>
        <td colspan="3" style="text-align:center;">No logs found.</td>
      </tr>
    {% endfor %}
  </tbody>
</table>

<!-- Pagination + Page Info at Bottom -->
{% if total_pages > 1 %}
  <div class="audit-pagination">

    {# Previous button #}
    {% if page > 1 %}
      <a class="pagination-btn"
         href="{{ url_for('admin_logs', page=page-1, username=username, action=action) }}">
        « Prev
      </a>
    {% else %}
      <span class="pagination-btn disabled">« Prev</span>
    {% endif %}

    {# Page numbers #}
    {% for p in range(1, total_pages + 1) %}
      {% if p == page %}
        <span class="pagination-btn current">{{ p }}</span>
      {% else %}
        <a class="pagination-btn"
           href="{{ url_for('admin_logs', page=p, username=username, action=action) }}">
          {{ p }}
        </a>
      {% endif %}
    {% endfor %}

    {# Next button #}
    {% if page < total_pages %}
      <a class="pagination-btn"
         href="{{ url_for('admin_logs', page=page+1, username=username, action=action) }}">
        Next »
      </a>
    {% else %}
      <span class="pagination-btn disabled">Next »</span>
    {% endif %}

    <div class="pagination-info">
      Page {{ page }} of {{ total_pages }} &nbsp;|&nbsp; Total logs: {{ total }}
    </div>
  </div>
{% else %}
  <div class="audit-pagination">
    <div class="pagination-info">
      Page {{ page }} of {{ total_pages }} &nbsp;|&nbsp; Total logs: {{ total }}
    </div>
  </div>
{% endif %}
{% endblock %}
